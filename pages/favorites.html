<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="../css/styles.css" />
     <link rel="stylesheet" href="../css/utilites.css">
     <title>Your Favorites</title>
</head>

<body>
     <div id="header-container"></div>
     <div class="wrapper">
          <h3>Favorites</h3>
          <div id="favorites">
               <div id="favorites-container">

               </div>
          </div>
     </div>

     <script src="../js/utilties.js"></script>
     <script>
          async function loadHeader() {
               const headerContainer = document.getElementById('header-container');
               try {
                    const response = await fetch('../components/header.html');
                    const html = await response.text();
                    headerContainer.innerHTML = html;

                    // Reinitialize search functionality after header loads
                    document.getElementById('search-form').addEventListener('submit', handleSearch);
               } catch (error) {
                    console.error('Error loading header:', error);
               }
          }
          loadHeader();

          async function loadFooter() {
               const footerContainer = document.getElementById('footer-container');
               try {
                    const response = await fetch('../components/footer.html');
                    const html = await response.text();
                    footerContainer.innerHTML = html;

               } catch (error) {
                    console.error('Error loading footer:', error);
               }
          }
          loadFooter();


          function moveToCart(item) {
               const result = addToCart(item);

               if (result.success) {
                    
                    toggleFavorite(item);
                    
                    displayFavorites();
                    alert('Item successfully moved to cart!');
                    updateHeaderCounts();
                    
               }
          }

          function displayFavorites(containerId = 'favorites-container') {
               const favorites = getFavorites();
               const favoritesContainer = document.getElementById(containerId);

               favoritesContainer.innerHTML = favorites.map(item => `
                    <div class="favorite-item">
                         <img src="${item.thumbnail}" alt="${item.title}">
                         <div class="item-details">
                              <h3>${item.title}</h3>
                              <p>By: ${item.author}</p>
                              <div class="action-buttons">
                                   <button onclick="moveToCart({
                                   id: '${item.id}',
                                   title: '${item.title}',
                                   author: '${item.author}',
                                   thumbnail: '${item.thumbnail}',
                                   price: ${item.price || 19.99}
                                   })">Move to Cart</button>
                                   <button onclick="toggleFavorite({
                                   id: '${item.id}',
                                   title: '${item.title}',
                                   author: '${item.author}',
                                   thumbnail: '${item.thumbnail}'
                                   }); displayFavorites(); updateHeaderCounts();">Remove from Favorites</button>
                              </div>
                         </div>
                    </div>
               `).join('');
          }
          displayFavorites();


     </script>


     <div id="footer-container">

     </div>
</body>

</html>